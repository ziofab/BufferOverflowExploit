// how to compile with stack execution:
// https://security.stackexchange.com/questions/234469/how-can-i-exploit-a-buffer-overflow-on-a-raspberry-pi-4
// gcc -g -no-pie -Wl,-z,norelro -fno-stack-protector -z execstack target.c -o target

#include <stdio.h>

void f()
{
  char buffer[16];
  int i, l;
  unsigned char cc[17];
  printf("%x\n", (unsigned int)buffer);
  printf("input %X> ", buffer);
    /*svuota il buffer*/
  fflush(stdout); 
  scanf("%s", buffer);
  
  l = 1173; // should be length of exploit
  
  printf("\n%d bytes read\n", l);
  i = 0;
  while (i<l)
  {
  	unsigned char c = buffer[i];
  	if ((i & 0xF) == 0)
  	{
  		printf("%p: ", &buffer[i]);
  	}
  	printf("%02X ", c);
  	if (c<' ')
  		c = '.';
  	cc[i & 0xF] = c;
  	cc[(i&0xF)+1] = 0;
  	i++;
  	if (((i & 0xF) == 0) || (i == l))
  		printf("%s\n", cc);
/*  	printf("%8X: %.2X %.2X %.2X %.2X %.2X %.2X %.2X %.2X - %.2X %.2X %.2X %.2X %.2X %.2X %.2X %.2X %c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c\n",
  	        &buffer[i], (unsigned char)buffer[i], (unsigned char)buffer[i+1], (unsigned char)buffer[i+2], (unsigned char)buffer[i+3], (unsigned char)buffer[i+4], (unsigned char)buffer[i+5], (unsigned char)buffer[i+6], (unsigned char)buffer[i+7], (unsigned char)buffer[i+8],
  	        (unsigned char)buffer[i+9],  (unsigned char)buffer[i+10], (unsigned char)buffer[i+11], (unsigned char)buffer[i+12], (unsigned char)buffer[i+13], (unsigned char)buffer[i+14], (unsigned char)buffer[i+15], 
  	        (unsigned char)buffer[i], (unsigned char)buffer[i+1], (unsigned char)buffer[i+2], (unsigned char)buffer[i+3], (unsigned char)buffer[i+4], (unsigned char)buffer[i+5], (unsigned char)buffer[i+6], (unsigned char)buffer[i+7], (unsigned char)buffer[i+8],
  	        (unsigned char)buffer[i+9],  (unsigned char)buffer[i+10], (unsigned char)buffer[i+11], (unsigned char)buffer[i+12], (unsigned char)buffer[i+13], (unsigned char)buffer[i+14], (unsigned char)buffer[i+15]);
  	i+=16;
*/
  }
  i=0;
  while ( buffer[i]>=' ' )
  {
    fputc(buffer[i]+1, stdout);
    i++;
  }
  printf("\n");
}

int main(int argc, char** argv) 
{
  f();
}
